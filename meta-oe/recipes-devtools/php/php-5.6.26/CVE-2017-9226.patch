commit f015fbdd95f76438cd86366467bb2b39870dd7c6
Author: K.Kosako <kosako@sofnec.co.jp>
Date:   Fri May 19 15:44:47 2017 +0900

    fix #55 : Byte value expressed in octal must be smaller than 256

Upstream-Status: Backport

CVE: CVE-2017-9226
Signed-off-by: Thiruvadi Rajaraman <tajaraman@mvista.com>


Index: php-5.6.26/ext/mbstring/oniguruma/regparse.c
===================================================================
--- php-5.6.26.orig/ext/mbstring/oniguruma/regparse.c	2017-09-19 19:41:03.440731438 +0530
+++ php-5.6.26/ext/mbstring/oniguruma/regparse.c	2017-09-19 19:41:56.952835081 +0530
@@ -3064,7 +3064,7 @@
 	PUNFETCH;
 	prev = p;
 	num = scan_unsigned_octal_number(&p, end, 3, enc);
-	if (num < 0) return ONIGERR_TOO_BIG_NUMBER;
+	if (num < 0 || num >= 256) return ONIGERR_TOO_BIG_NUMBER;
 	if (p == prev) {  /* can't read nothing. */
 	  num = 0; /* but, it's not error */
 	}
@@ -3436,7 +3436,7 @@
       if (IS_SYNTAX_OP(syn, ONIG_SYN_OP_ESC_OCTAL3)) {
 	prev = p;
 	num = scan_unsigned_octal_number(&p, end, (c == '0' ? 2:3), enc);
-	if (num < 0) return ONIGERR_TOO_BIG_NUMBER;
+	if (num < 0 || num >= 256) return ONIGERR_TOO_BIG_NUMBER;
 	if (p == prev) {  /* can't read nothing. */
 	  num = 0; /* but, it's not error */
 	}
