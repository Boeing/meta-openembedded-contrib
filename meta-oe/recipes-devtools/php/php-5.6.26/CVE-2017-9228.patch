commit 3b63d12038c8d8fc278e81c942fa9bec7c704c8b
Author: K.Kosako <kosako@sofnec.co.jp>
Date:   Wed May 24 13:43:25 2017 +0900

    fix #60 : invalid state(CCS_VALUE) in parse_char_class()

Upstream-Status: Backport

CVE: CVE-2017-9228
Signed-off-by: Thiruvadi Rajaraman <trajaraman@mvista.com>


Index: php-5.6.26/ext/mbstring/oniguruma/regparse.c
===================================================================
--- php-5.6.26.orig/ext/mbstring/oniguruma/regparse.c	2016-09-16 02:32:50.000000000 +0530
+++ php-5.6.26/ext/mbstring/oniguruma/regparse.c	2017-08-30 12:52:50.468290561 +0530
@@ -4068,7 +4068,9 @@
     }
   }
 
-  *state = CCS_VALUE;
+  if (*state != CCS_START)
+    *state = CCS_VALUE;
+
   *type  = CCV_CLASS;
   return 0;
 }
